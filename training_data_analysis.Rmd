---
title: "Training data analysis"
author: "Leah Kemp"
always_allow_html: true
output:
  html_document:
    toc: true
    toc_depth: 3
    toc_float:
      collapsed: true
      smooth_scroll: true
    number_sections: false
    self_contained: yes
  editor_options: 
    chunk_output_type: console
---

```{r setup, include=FALSE}
# global chunk settings
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, error = FALSE, message = FALSE, fig.align = "center")
```

```{r}
# get renv to restore packages with renv
utils::install.packages()
base::library(renv)

# install packages based on renv lock file
renv::restore()
```

```{r}
# load packages
base::library(googlesheets4)
base::library(tidyverse)
base::library(janitor)
base::library(DT)
base::library(scales)
base::library(lubridate)
base::library(plotly)
```

```{r}
# TO UTILISE A GITHUB ACTION TO AUTOMATICALY RENDER THIS RMD TO HTML AND RENDER A GITHUB PAGES WEBPAGE
# this code chunk isn't required to render locally

# get the api key for accessing google sheets stored in the secrets section of the github repo
json <- base::Sys.getenv("SHEETS_API_JSON")

# utilise the google sheets api key to autorise access to the google sheets
googlesheets4::gs4_auth_configure(googlesheets4::gs4_auth(email = "leahmhkemp@gmail.com", path=json))
```

```{r}
# web links to excel spreadsheets in google docs
training_plan_july_2021_july_2022 <- "https://docs.google.com/spreadsheets/d/1jSN7xN3CIQUQNUssWz2c9Wz-ab5qCaBYaYvdsNFKSY0/edit#gid=35820724"
training_plan_feb_august_2021 <- "https://docs.google.com/spreadsheets/d/10gONryFN9afkoZvwuJ18rZ_kEO2p_R-H2O85Nr8ktv4/edit#gid=0"

# read in data from google sheets
M5_GYM_FULL_BODY <- googlesheets4::read_sheet(training_plan_july_2021_july_2022,
                                              sheet = "M5_GYM_FULL_BODY")

M5_DAILY_FLEX <- googlesheets4::read_sheet(training_plan_july_2021_july_2022,
                                           sheet = "M5_DAILY_FLEX")

# M4_POLE_CONDITIONING <- read_sheet(training_plan_july_2021_july_2022,
#                                    sheet = "M4_POLE_CONDITIONING")
M4_DAILY_FLEX <- googlesheets4::read_sheet(training_plan_july_2021_july_2022,
                                           sheet = "M4_DAILY_FLEX")

M4_POLE_OPEN_TRAIN <- googlesheets4::read_sheet(training_plan_july_2021_july_2022,
                                                sheet = "M4_POLE_OPEN_TRAIN")

M4_GYM_FULL_BODY <- googlesheets4::read_sheet(training_plan_july_2021_july_2022,
                                              sheet = "M4_GYM_FULL_BODY")

M3_DAILY_FLEX <- googlesheets4::read_sheet(training_plan_july_2021_july_2022,
                                           sheet = "M3_DAILY_FLEX")

M3_POLE_UPPER_BODY_CORE <- googlesheets4::read_sheet(training_plan_july_2021_july_2022,
                                                     sheet = "M3_POLE_UPPER_BODY_CORE")

M3_LOWER_BODY <- googlesheets4::read_sheet(training_plan_july_2021_july_2022,
                                           sheet = "M3_LOWER_BODY")

M2_FULL_BODY <- googlesheets4::read_sheet(training_plan_july_2021_july_2022,
                                          sheet = "M2_FULL_BODY")

M2_CORE_FLEX <- googlesheets4::read_sheet(training_plan_july_2021_july_2022,
                                          sheet = "M2_CORE_FLEX")

M1_POLE <- googlesheets4::read_sheet(training_plan_july_2021_july_2022,
                                     sheet = "M1_POLE")

M1_GYM <- googlesheets4::read_sheet(training_plan_july_2021_july_2022,
                                    sheet = "M1_GYM")

targeting_the_requirements <- googlesheets4::read_sheet(training_plan_feb_august_2021,
                                                        sheet = "targeting_the_requirements")

targeting_the_tricks <- googlesheets4::read_sheet(training_plan_feb_august_2021,
                                                  sheet = "targeting_the_tricks")

# create a list of the datasets I'm working with
dataset_list <- base::list(M5_GYM_FULL_BODY,
                           M5_DAILY_FLEX,
                           M4_DAILY_FLEX,
                           M4_POLE_OPEN_TRAIN,
                           M4_GYM_FULL_BODY,
                           M3_DAILY_FLEX,
                           M3_POLE_UPPER_BODY_CORE,
                           M3_LOWER_BODY,
                           M2_FULL_BODY,
                           M2_CORE_FLEX,
                           M1_POLE,
                           M1_GYM,
                           targeting_the_tricks,
                           targeting_the_requirements)

# setup my function to prepare the weights data
prepare_weights_data <- function(df_list) {
  
  data <- df_list %>%
    # recode empty strings "" by NAs
    dplyr::na_if("") %>%
    
    # remove empty rows
    janitor::remove_empty(c("rows")) %>%  
    
    # remove some columns to only get the weights data
    # this will also remove columns that don't have a date in the name (data hasn't been entered in those columns)
    dplyr::select(requirement,
                  exercise,
                  matches("\\d{1,2}/\\d{1,2}/\\d{1,4}")) %>%
    dplyr::select(!dplyr::contains(c("notes", "reps_or_secs"))) %>%
    
    # format all columns that have a date in their name, to integer format
    dplyr::mutate_at(dplyr::vars(dplyr::matches("\\d{1,2}/\\d{1,2}/\\d{1,4}.set")), base::as.double) %>%
    
    # make this data long for downstream analyses
    # this also extracts the date from the column names and makes a variable out of it
    tidyr::pivot_longer(cols = -c(requirement, exercise),
                        names_pattern = "(\\d{1,2}/\\d{1,2}/\\d{1,4}).(....).(weight)$",
                        names_to = c("date", "set", "weight")) %>%
    dplyr::mutate(date=base::ifelse(date=="", "value", date)) %>%
    
    # clean up columns
    dplyr::select(-weight) %>%
    dplyr::rename(weight = value) %>%
    
    # remove rows with NA values (exercise not done)
    stats::na.omit()
  
  # format date column as a date
  data$date <- base::as.Date(data$date,"%d/%m/%y", tz = "NZ")
  
  return(data)
  
}

# setup my function to prepare the reps/secs data
prepare_reps_or_secs_data <- function(df_list) {
  
  data <- df_list %>%
    # recode empty strings "" by NAs
    dplyr::na_if("") %>%
    
    # remove empty rows
    janitor::remove_empty(c("rows")) %>%  
    
    # remove some columns to only get the sets and reps
    # this will also remove columns that don't have a date in the name (data hasn't been entered in those columns)
    dplyr::select(requirement,
                  exercise,
                  dplyr::matches("\\d{1,2}/\\d{1,2}/\\d{1,4}")) %>%
    # remove some columns to only get the sets and reps
    select(!contains(c("notes", "weight"))) %>%
    
    # format all columns that have a date in their name, to integer format
    dplyr::mutate_at(dplyr::vars(dplyr::matches("\\d{1,2}/\\d{1,2}/\\d{1,4}.set")), base::as.integer) %>%
    
    # make this data long for downstream analyses
    # this also extracts the date from the column names and makes a variable out of it
    tidyr::pivot_longer(cols = -c(requirement, exercise),
                        names_pattern = "(\\d{1,2}/\\d{1,2}/\\d{1,4}).(....).(reps_or_secs)$",
                        names_to = c("date", "set", "reps_or_secs")) %>%
    dplyr::mutate(date=base::ifelse(date=="", "value", date)) %>%
    
    # clean up columns
    dplyr::select(-reps_or_secs) %>%
    dplyr::rename(reps_or_secs = value) %>%
    
    # remove rows with NA values (exercise not done)
    stats::na.omit()
  
  # format date column as a date
  data$date <- base::as.Date(data$date,"%d/%m/%y", tz = "NZ")
  
  return(data)
  
}

# apply my function to prepare weights and reps/secs data
weights_data <- base::lapply(dataset_list, prepare_weights_data)
reps_or_secs_data <- base::lapply(dataset_list, prepare_reps_or_secs_data)

# collapse dataframes into one dataset
weights_data <- base::Reduce(base::rbind, weights_data)
reps_or_secs_data <- base::Reduce(base::rbind, reps_or_secs_data)

# merge weights and reps/secs data
data <- dplyr::full_join(weights_data,
                         reps_or_secs_data,
                         by = c("requirement", "exercise", "date", "set"))

# replace missing values for weight (where I didn't enter a value since no weight was used) with 0
data <- base::replace(data, base::is.na(data), 0)

# generalise the requirement list
upper_body_strength <- c("Cup grip handspring deadlift",
                         "Internal and external shoulder rotation",
                         "No leg climb",
                         "Pushing strength",
                         "Shoulder flexion (with external rotation)",
                         "Shoulder flexion (with neutral)",
                         "Shoulder mount deadlift",
                         "True grip ayesha",
                         "Twisted grip handspring deadlift",
                         "Upper body power",
                         "Upper body strength",
                         "Pulling strength")

lower_body_strength <- c("Lower body power",
                         "Lower body strength")

core_strength <- c("Anti-extension core strength",
                   "Anti-lateral core strength",
                   "Anti-rotation core strength")

back_bending_rotation_flexibility <- c("Back flexibility",
                                       "Thoracic rotation",
                                       "Thoracic lateral bend",
                                       "Upper back/shoulder flexibility",
                                       "Shoulder flexion flexibility and strength")

splits_flexibility <- c("Active hamstring flexibility",
                        "Active hamstring flexibility/hip flexion strength",
                        "Active hip adduction and abduction",
                        "Front splits",
                        "Hamstring nerve tension",
                        "Hip extension flexibility",
                        "Internal and external hip rotation",
                        "Middle split",
                        "Pancake split",
                        "Foot point",
                        "Microbend drills",
                        "Hip flexor flexibility",
                        "Hamstring flexibility",
                        "Hip flexion strength",
                        "Glute and hamstring strength",
                        "Hip abduction strength",
                        "Hip adduction strength")

skills <- c("Shoulder mount flag",
            "Shoulder mount deadlift",
            "Shouldermount hops up pole",
            "Muscle up to pencil",
            "Human flag",
            "Spatchcock",
            "Twisted grip handspring deadlift",
            "Twisted grip aerial handspring",
            "Twisted grip iron X",
            "Bird of paradise",
            "No leg climb")

# add this broader requirements as a new column in my data
data <- data %>%
  dplyr::mutate(requirement_broad = dplyr::case_when(requirement %in% upper_body_strength ~ "Upper body strength",
                                                     exercise == "Pole invert starting position isometric hold" ~ "Upper body strength",
                                                     exercise == "Pole invert finishing position isometric hold" ~ "Upper body strength",
                                                     requirement %in% lower_body_strength ~ "Lower body strength",
                                                     requirement %in% core_strength ~ "Core strength",
                                                     exercise == "Pole invert knee tucks" ~ "Core strength",
                                                     requirement %in% back_bending_rotation_flexibility  ~ "Back bending and rotation flexibility",
                                                     requirement %in% splits_flexibility ~ "Splits flexibility",
                                                     requirement %in% skills ~ "Skills"))

# setup plotting functions
time_series_plot <- function(data, wrap_variable) {
  data %>%
    ggplot2::ggplot(aes(x = date, y = number_of_sets_completed)) +
    ggplot2::geom_bar(stat="identity") +
    ggplot2::theme(legend.position = "none") +
    ggplot2::facet_wrap(dplyr::vars(exercise), ncol = 1) +
    ggplot2::geom_vline(xintercept = base::as.numeric("18/12/2021"), colour = "red") +
    ggplot2::labs(title = "",
                  x = "Date",
                  y = "Number of sets") +
    ggplot2::theme_bw() +
    ggplot2::theme(axis.text.x = ggplot2::element_text(colour = "grey20", size = 8, angle = 90,
                                                       hjust = 0.5, vjust = 0.5),
                   axis.text.y = ggplot2::element_text(colour = "grey20", size = 8),
                   legend.title = ggplot2::element_blank(),
                   text = ggplot2::element_text(size = 8)) +
    # create a vertical line in plots at certain date where all my training data was collected (finished up with Jhene)
    ggplot2::scale_x_date(labels = scales::date_format("%Y-%m-%d"),
                          breaks = "1 month", date_labels = base::paste0("%m", "/", "%Y"))
}

time_series_summary_broad_plot <- function(data) {
  data %>%
    ggplot2::ggplot(aes(x = date, y = number_of_sets_completed)) +
    ggplot2::geom_bar(stat="identity") +
    ggplot2::theme(legend.position = "none") +
    ggplot2::facet_wrap(dplyr::vars(requirement_broad), ncol = 1) +
    ggplot2::geom_vline(xintercept = base::as.numeric("18/12/2021"), colour = "red") +
    ggplot2::labs(title = "",
                  x = "Date",
                  y = "Number of sets") +
    ggplot2::theme_bw() +
    ggplot2::theme(axis.text.x = ggplot2::element_text(colour = "grey20", size = 8, angle = 90,
                                                       hjust = 0.5, vjust = 0.5),
                   axis.text.y = ggplot2::element_text(colour = "grey20", size = 8),
                   legend.title = ggplot2::element_blank(),
                   text = ggplot2::element_text(size = 8)) +
    # create a vertical line in plots at certain date where all my training data was collected (finished up with Jhene)
    ggplot2::scale_x_date(labels = scales::date_format("%Y-%m-%d"),
                          breaks = "1 month", date_labels = base::paste0("%m", "/", "%Y"))
}

time_series_summary_plot <- function(data) {
  data %>%
    ggplot2::ggplot(aes(x = date, y = number_of_sets_completed)) +
    ggplot2::geom_bar(stat="identity") +
    ggplot2::theme(legend.position = "none") +
    ggplot2::facet_wrap(dplyr::vars(requirement), ncol = 1) +
    ggplot2::geom_vline(xintercept = base::as.numeric("18/12/2021"), colour = "red") +
    ggplot2::labs(title = "",
                  x = "Date",
                  y = "Number of sets") +
    ggplot2::theme_bw() +
    ggplot2::theme(axis.text.x = ggplot2::element_text(colour = "grey20", size = 8, angle = 90,
                                                       hjust = 0.5, vjust = 0.5),
                   axis.text.y = ggplot2::element_text(colour = "grey20", size = 8),
                   legend.title = ggplot2::element_blank(),
                   text = ggplot2::element_text(size = 8)) +
    # create a vertical line in plots at certain date where all my training data was collected (finished up with Jhene)
    ggplot2::scale_x_date(labels = scales::date_format("%Y-%m-%d"),
                          breaks = "1 month", date_labels = base::paste0("%m", "/", "%Y"))
}
```

## PR

```{r, out.width = "100%"}
# get the combinations of weights and reps/sec for each exercise
weight_reps_pairs <- data %>%
  dplyr::select(-c(set, requirement, requirement_broad)) %>%
  dplyr::group_by(exercise,reps_or_secs, weight) %>%
  dplyr::summarise(reps_or_secs, weight)

# split dataset by exercise
weight_reps_pairs_by_exercise <- base::split(weight_reps_pairs, weight_reps_pairs$exercise)

get_pr <- function(data_list) {
  
  # order data by highest weight and highest number of reps/secs (priority to highest weight)
  ordered <- data_list %>%
    dplyr::arrange(dplyr::desc(weight), dplyr::desc(reps_or_secs))
  
  # get the top row
  pr <- ordered[1, ]
  
  return(pr)
  
}

# apply my function to my list of datasets (so the pr is calculated for each exercise)
pr <- base::lapply(weight_reps_pairs_by_exercise, get_pr)

# collapse results into a single dataframe
pr <- base::Reduce(rbind, pr)

# put in table
pr %>%
  dplyr::select(exercise, reps_or_secs, weight) %>%
  DT::datatable(filter = "top",
                colnames = c("Exercise",
                             "Reps/secs",
                             "Max weight"),
                rownames = FALSE,
                extensions = list("ColReorder" = NULL,
                                  "Buttons" = NULL,
                                  "FixedColumns" = list(leftColumns=1)),
                options = list(
                  dom = "BRrltpi",
                  autoWidth = TRUE,
                  buttons =
                    base::list("copy",
                               base::list(extend = "collection",
                                          buttons = c("csv", "excel", "pdf"),
                                          text = "Download"),
                               I("colvis"))))
```

## Excercise list

```{r, out.width = "100%"}
# create table of list of exercises
data %>%
  dplyr::select(exercise,
                requirement_broad) %>%
  base::unique() %>%
  # order alphabetically by requirement
  dplyr::arrange(exercise) %>%
  # make factors for table formatting
  dplyr::mutate(requirement_broad = base::as.factor(requirement_broad)) %>%
  DT::datatable(filter = "top",
                colnames = c("Exercise",
                             "Requirement - broad"),
                rownames = FALSE,
                extensions = list("ColReorder" = NULL,
                                  "Buttons" = NULL,
                                  "FixedColumns" = list(leftColumns=1)),
                options = list(
                  dom = "BRrltpi",
                  autoWidth = TRUE,
                  buttons =
                    base::list("copy",
                               base::list(extend = "collection",
                                          buttons = c("csv", "excel", "pdf"),
                                          text = "Download"),
                               I("colvis"))))
```

## Sets completed - time series {.tabset .tabset-fade}

*Note. no lower body/upper body and core strength data available from personal training sessions between Dec 2020 to Dec 2021*

```{r}
# summarise data by broad requirement and date
time_series_data <- data %>%
  dplyr::group_by(requirement_broad, date) %>%
  dplyr::summarise(number_of_sets_completed = n())
```

### All categories

```{r, out.width = "100%"}
# split data by broad requirement
time_series_data <- time_series_data %>% base::split(time_series_data$requirement_broad)

# plot
plotly::plot_ly(type = "scatter",
                mode = "markers + lines",
                texttemplate="%{label}") %>%
  plotly::add_trace(data = time_series_data$`Back bending and rotation flexibility`,
                    x = ~date,
                    y = ~number_of_sets_completed,
                    name = "Back bending and rotation flexibility") %>%
  plotly::add_trace(data = time_series_data$`Core strength`,
                    x = ~date,
                    y = ~number_of_sets_completed,
                    name = "Core strength") %>%
  plotly::add_trace(data = time_series_data$`Lower body strength`,
                    x = ~date,
                    y = ~number_of_sets_completed,
                    name = "Lower body strength") %>%
  plotly::add_trace(data = time_series_data$`Splits flexibility`,
                    x = ~date,
                    y = ~number_of_sets_completed,
                    name = "Splits flexibility") %>%
  plotly::add_trace(data = time_series_data$`Upper body strength`,
                    x = ~date,
                    y = ~number_of_sets_completed,
                    name = "Upper body strength") %>%
  plotly::layout(showlegend = TRUE,
                 xaxis = base::list(rangeslider = base::list(visible = TRUE),
                                    rangeselector = base::list(
                                      buttons = base::list(
                                        base::list(count=1, label="1m", step="month", stepmode="backward"),
                                        base::list(count=3, label="3m", step="month", stepmode="backward"),
                                        base::list(count=6, label="6m", step="month", stepmode="backward"),
                                        base::list(count=1, label="YTD", step="year", stepmode="todate"),
                                        base::list(count=1, label="1y", step="year", stepmode="backward"),
                                        base::list(step="all"))))) %>%
  plotly::layout(xaxis = base::list(title = "Date",
                                    zerolinecolor = "#ffff",
                                    zerolinewidth = 2,
                                    gridcolor = "ffff"),
                 yaxis = base::list(title = "Number of sets completed",
                                    zerolinecolor = "#ffff",
                                    zerolinewidth = 2,
                                    gridcolor = "ffff"),
                 plot_bgcolor="#e5ecf6", width = 900)
```

### Core strength

```{r}
# summarise data by broad requirement, exercise and date
time_series_data <- data %>%
  dplyr::group_by(requirement_broad, exercise, date) %>%
  dplyr::summarise(number_of_sets_completed = n())
```

```{r, fig.height = 35, out.width = "100%"}
time_series_data %>%
  dplyr::filter(requirement_broad == "Core strength") %>%
  time_series_plot()
```

### Lower body strength

```{r, fig.height = 20, out.width = "100%"}
time_series_data %>%
  dplyr::filter(requirement_broad == "Lower body strength") %>%
  time_series_plot()
```

### Upper body strength

```{r, fig.height = 35, out.width = "100%"}
time_series_data %>%
  dplyr::filter(requirement_broad == "Upper body strength") %>%
  time_series_plot()
```

### Splits flexibility

```{r, fig.height = 40, out.width = "100%"}
time_series_data %>%
  dplyr::filter(requirement_broad == "Splits flexibility") %>%
  time_series_plot()
```

### Back bending and rotation flexibility

```{r, fig.height = 30, out.width = "100%"}
time_series_data %>%
  dplyr::filter(requirement_broad == "Back bending and rotation flexibility") %>%
  time_series_plot()
```

## Stretching

### Weekly total time stretching

**Target: 5-10 minutes per week per muscle**

```{r, out.width = "100%"}
DAILY_FLEX <- dplyr::full_join(M3_DAILY_FLEX, M4_DAILY_FLEX,  by = c("requirement", "exercise"))

# remove microbend drills
DAILY_FLEX <- DAILY_FLEX %>%
  dplyr::filter(requirement != "Microbend drills")

# recode empty strings "" by NAs
DAILY_FLEX <- DAILY_FLEX %>%
  dplyr::na_if("") 

# format all columns that have a date in their name, to integer format
DAILY_FLEX <- DAILY_FLEX %>%
  dplyr::mutate_at(dplyr::vars(dplyr::matches("\\d{1,2}/\\d{1,2}/\\d{1,2}.set")), base::as.integer)

# remove some columns to only get the sets and reps
# this'll also remove columns that don't have a date in the name (data hasn't been entered in those columns)
DAILY_FLEX <- DAILY_FLEX %>%
  dplyr::select(requirement,
                exercise,
                matches("\\d{1,2}/\\d{1,2}/\\d{1,2}"))

# make this data long for downstream analyses
# this also extracts the date from the column names and makes a variable out of it
DAILY_FLEX_long <- tidyr::pivot_longer(DAILY_FLEX,
                                       cols = -c(requirement, exercise),
                                       names_pattern = "(\\d{1,2}/\\d{1,2}/\\d{1,2}).(....).(reps_or_secs)$",
                                       names_to = c("date", "set", "reps_or_secs")) %>% 
  dplyr::mutate(date=base::ifelse(date=="", "value", date))

# clean up columns
DAILY_FLEX_long <- DAILY_FLEX_long %>%
  dplyr::select(-reps_or_secs) %>%
  dplyr::rename(reps_or_secs = value)

# remove rows with NA values (exercise not done)
DAILY_FLEX_long <- DAILY_FLEX_long %>%
  stats::na.omit()

# format date column as a date
DAILY_FLEX_long$date <- base::as.Date(DAILY_FLEX_long$date,"%d/%m/%y")

# create a column that specifies the week
DAILY_FLEX_long <- DAILY_FLEX_long %>%
  dplyr::mutate(week = lubridate::week(lubridate::ymd(DAILY_FLEX_long$date)))
```

```{r}
# summarise data by week and exercise
time_series_data <- DAILY_FLEX_long %>%
  dplyr::group_by(requirement, exercise, week) %>%
  dplyr::summarise(number_of_reps_or_secs_completed = sum(reps_or_secs))
```

```{r, out.width = "100%"}
# a function for getting integer y-axis values
# (grabbed code from: https://joshuacook.netlify.app/post/integer-values-ggplot-axis/)
integer_breaks <- function(n = 5, ...) {
  fxn <- function(x) {
    breaks <- floor(pretty(x, n, ...))
    names(breaks) <- attr(breaks, "labels")
    breaks
  }
  return(fxn)
}

time_series_data %>%
  ggplot2::ggplot(aes(x = week, y = number_of_reps_or_secs_completed)) +
  ggplot2::geom_bar(stat="identity") +
  ggplot2::theme(legend.position = "none") +
  ggplot2::facet_wrap(dplyr::vars(requirement)) +
  ggplot2::labs(title = "",
                x = "Week",
                y = "Total seconds") +
  ggplot2::theme_bw() +
  ggplot2::theme(axis.text.x = element_text(colour = "grey20", size = 8, angle = 90,
                                            hjust = 0.5, vjust = 0.5),
                 axis.text.y = element_text(colour = "grey20", size = 8),
                 legend.title = element_blank(),
                 text = element_text(size = 8)) +
  ggplot2::geom_hline(yintercept = 300, colour = "orange") +
  ggplot2::geom_hline(yintercept = 600, colour = "forest green") +
  ggplot2::scale_x_continuous(breaks = integer_breaks())
```

### Stretching frequency

**Target: 5-6 days week per week**

```{r}
# summarise data by week and exercise
time_series_data <- DAILY_FLEX_long %>%
  dplyr::group_by(requirement, week) %>%
  dplyr::summarise(number_of_sessions_completed = base::length(base::unique(date)))
```

```{r, out.width = "100%"}
time_series_data %>%
  ggplot2::ggplot(aes(x = week, y = number_of_sessions_completed)) +
  ggplot2::geom_bar(stat="identity") +
  ggplot2::theme(legend.position = "none") +
  ggplot2::facet_wrap(dplyr::vars(requirement)) +
  ggplot2::labs(title = "",
                x = "Week",
                y = "Total number of sessions") +
  ggplot2::theme_bw() +
  ggplot2::theme(axis.text.x = element_text(colour = "grey20", size = 8, angle = 90,
                                            hjust = 0.5, vjust = 0.5),
                 axis.text.y = element_text(colour = "grey20", size = 8),
                 legend.title = element_blank(),
                 text = element_text(size = 8)) +
  ggplot2::geom_hline(yintercept = 5, colour = "orange") +
  ggplot2::geom_hline(yintercept = 6, colour = "forest green") +
  ggplot2::scale_x_continuous(breaks = integer_breaks())
```

```{r, cleanup, results = "hide"}
# clean up
rm(list = ls())
```
